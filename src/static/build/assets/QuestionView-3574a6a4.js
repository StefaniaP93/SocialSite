import{_ as A,o,c as r,a as t,t as l,b as f,d as _,e as h,f as w,r as g,g as q,w as v,h as m,v as b,F as x,i as k,j as C,k as Q,l as B,p as S,m as U}from"./index-612dace3.js";const D={name:"AnswerComponent",props:{answer:{type:Object,required:!0},requestUser:{type:String,required:!0}},computed:{isAnswerAuthor(){return this.answer.author===this.requestUser}},data(){return{answerEditing:!1,error:null}},methods:{async updateAnswer(){if(!this.answer.body){this.error="Non puoi codividere una risposta vuota";return}`${endpoints.AnswerDetail}${this.answer.uuid}`}}},R={class:"mt-3"},T={class:"mb-1"},V={key:0,rows:"5",class:"form-control"},N={key:1},E={key:0},F=t("hr",null,null,-1);function H(n,e,c,y,s,i){return o(),r("div",R,[t("p",T,[t("strong",null,l(c.answer.author),1),f(", "+l(c.answer.created_at),1)]),t("div",null,[s.answerEditing?(o(),r("textarea",V)):(o(),r("p",N,l(c.answer.body),1))]),i.isAnswerAuthor?(o(),r("div",E,[t("button",{onClick:e[0]||(e[0]=(...a)=>i.updateAnswer&&i.updateAnswer(...a)),class:"btn btn-sm btn-warning"},"Aggiorna"),t("button",{onClick:e[1]||(e[1]=(...a)=>s.answerEditing&&s.answerEditing(...a))},"Aggiorna")])):_("",!0),F])}const I=A(D,[["render",H]]),L={name:"QuestionAction",props:{slug:{type:String,required:!0}},data(){return{showDeleteConfirmBtn:!1}},methods:{async deleteQuestion(){const n=`${h.questionsCRUD}${this.slug}/`;try{await w.delete(n),this.$router.push({name:"home"})}catch(e){console.log(e),alert(e.response.statusText)}}}};function P(n,e,c,y,s,i){const a=g("RouterLink");return o(),r(x,null,[q(a,{to:{name:"question-editor",params:{slug:c.slug}},class:"btn btn-sm btn-warning"},{default:v(()=>[f(" Modifica ")]),_:1},8,["to"]),t("button",{class:"btn btn-sm btn-danger mx-1",onClick:e[0]||(e[0]=d=>s.showDeleteConfirmBtn=!s.showDeleteConfirmBtn)},"Elimina"),m(t("button",{class:"btn btn-outline-danger btn-sm",onClick:e[1]||(e[1]=(...d)=>i.deleteQuestion&&i.deleteQuestion(...d))},"Conferma",512),[[b,s.showDeleteConfirmBtn]])],64)}const M=A(L,[["render",P]]);const j={name:"QuestionView",props:{slug:{type:String,required:!0}},components:{AnswerComponent:I,QuestionAction:M},data(){return{question:{},answers:[],next:null,loadingAnswer:!1,requestUser:null,userHasAnswered:!1,showForm:!1,newAnswerBody:null,error:null}},computed:{isQuestionAuthor(){return this.question.author===this.requestUser}},methods:{setPageTitle(n){document.title=n},setRequestUser(){this.requestUser=window.localStorage.getItem("username")},async getQuestionsData(){const n=`${h.questionsCRUD}${this.slug}/`;try{const e=await w.get(n);this.answers.unshift(e.data),this.question=e.data,this.userHasAnswered=e.data.user_has_answered,this.setPageTitle(e.data.content)}catch(e){console.log(e),this.question=null,this.setPageTitle(e.response.statusText)}},async getQuestionAnswers(){let n=`${h.questionsAnswersList}${this.slug}/`;this.next&&(n=this.next),this.loadingAnswer=!0;try{const e=await w.get(n);this.answers.push(...e.data.results),this.loadingAnswer=!1,e.data.next?this.next=e.data.next:this.next=null}catch(e){console.log(e),alert(e.response.statusText)}},async onSubmit(){if(!this.newAnswerBody){this.error="Non puoi pubblicare una risposta vuota!";return}const n=`${h.questionsNewAnswer}${this.slug}/`;try{const e=await w.post(n,{body:this.newAnswerBody});this.newAnswerBody=null,this.showForm=!1,this.userHasAnswered=!0,this.error&&(this.error=null)}catch(e){console.log(e),this.error=response.error.statusText}}},created(){this.getQuestionsData(),this.getQuestionAnswers(),this.setRequestUser()}},p=n=>(S("data-v-a7078ccb"),n=n(),U(),n),O={key:0,class:"container"},z={class:"mb-0"},G={class:"question-author"},J={class:"mb-1"},K={key:0,class:"mb-3"},W={key:1},X=p(()=>t("p",null,"Hai Risposto a questa domanda!",-1)),Y=[X],Z={key:2},$=p(()=>t("p",null,"Rispondi alla domanda!",-1)),ee=p(()=>t("button",{type:"submit",class:"btn btn-sm btn-outline-success mt-1"},"Rispondi",-1)),se={key:0},te={key:3},ne={key:1},oe=p(()=>t("h1",{class:"text-danger text-center"},"404 - Domanda non trovata!",-1)),re=[oe];function ie(n,e,c,y,s,i){const a=g("QuestionAction"),d=g("AnswerComponent");return s.question?(o(),r("div",O,[t("h1",null,l(s.question.content),1),t("p",z,[f(" Pubblicata da: "),t("span",G,l(s.question.author),1)]),t("p",J,l(s.question.created_at),1),i.isQuestionAuthor?(o(),r("div",K,[q(a,{slug:s.question.slug},null,8,["slug"])])):_("",!0),s.userHasAnswered?(o(),r("div",W,Y)):s.showForm?(o(),r("div",Z,[$,t("form",{onSubmit:e[1]||(e[1]=C((...u)=>i.onSubmit&&i.onSubmit(...u),["prevent"]))},[m(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=u=>s.newAnswerBody=u),class:"form-control",rows:"5"},null,512),[[k,s.newAnswerBody]]),ee],32),s.error?(o(),r("p",se,l(s.error),1)):_("",!0)])):(o(),r("div",te,[t("button",{class:"btn btn-sm btn-success mt-1",onClick:e[2]||(e[2]=u=>s.showForm=!0)},"Rispondi alla domanda")])),t("div",null,[(o(!0),r(x,null,Q(s.answers,u=>(o(),B(d,{answer:u,requestUser:s.requestUser,key:u.uuid},null,8,["answer","requestUser"]))),128)),m(t("p",null,"... caricamento ...",512),[[b,s.loadingAnswer]]),m(t("button",{class:"btn btn-sm btn-outline-success",onClick:e[3]||(e[3]=(...u)=>i.getQuestionAnswers&&i.getQuestionAnswers(...u))},"Carica altre Risposte",512),[[b,s.next]])])])):(o(),r("div",ne,re))}const ae=A(j,[["render",ie],["__scopeId","data-v-a7078ccb"]]);export{ae as default};
